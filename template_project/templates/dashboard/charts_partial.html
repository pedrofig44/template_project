{% if chart_type == 'temp' or temperature_chart %}
    <div id="temperature-chart" style="height: 300px;"></div>
    <script>
        (function() { // IIFE to create a new scope for variables
            console.log("Rendering temperature chart");
            
            // Always purge first to clean up
            try {
                if (document.getElementById('temperature-chart')._Plotly) {
                    Plotly.purge('temperature-chart');
                }
            } catch (e) {
                console.log("No previous plot to purge");
            }
            
            // Parse the data and create the chart
            const chartData = JSON.parse('{{ temperature_chart|escapejs }}');
            Plotly.newPlot('temperature-chart', chartData.data, chartData.layout);
            
            // Apply night mode if needed
            if (document.body.classList.contains('night-mode')) {
                Plotly.relayout('temperature-chart', {
                    'paper_bgcolor': '#191C24',
                    'plot_bgcolor': '#191C24',
                    'font.color': '#ffffff',
                    'xaxis.color': '#ffffff',
                    'yaxis.color': '#ffffff'
                });
            }
        })(); // Immediately execute the function
    </script>
{% endif %}

{% if chart_type == 'humid' or humidity_chart %}
    <div id="humidity-chart" style="height: 300px;"></div>
    <script>
        (function() { // IIFE to create a new scope
            console.log("Rendering humidity chart");
            
            // Always purge first to clean up
            try {
                if (document.getElementById('humidity-chart')._Plotly) {
                    Plotly.purge('humidity-chart');
                }
            } catch (e) {
                console.log("No previous plot to purge");
            }
            
            // Parse the data and create the chart
            const chartData = JSON.parse('{{ humidity_chart|escapejs }}');
            Plotly.newPlot('humidity-chart', chartData.data, chartData.layout);
            
            // Apply night mode if needed
            if (document.body.classList.contains('night-mode')) {
                Plotly.relayout('humidity-chart', {
                    'paper_bgcolor': '#191C24',
                    'plot_bgcolor': '#191C24',
                    'font.color': '#ffffff',
                    'xaxis.color': '#ffffff',
                    'yaxis.color': '#ffffff'
                });
            }
        })();
    </script>
{% endif %}

{% if chart_type == 'precip' or precipitation_chart %}
    <div id="precipitation-chart" style="height: 300px;"></div>
    <script>
        (function() { // IIFE to create a new scope
            console.log("Rendering precipitation chart");
            
            // Always purge first to clean up
            try {
                if (document.getElementById('precipitation-chart')._Plotly) {
                    Plotly.purge('precipitation-chart');
                }
            } catch (e) {
                console.log("No previous plot to purge");
            }
            
            // Parse the data and create the chart
            const chartData = JSON.parse('{{ precipitation_chart|escapejs }}');
            Plotly.newPlot('precipitation-chart', chartData.data, chartData.layout);
            
            // Apply night mode if needed
            if (document.body.classList.contains('night-mode')) {
                Plotly.relayout('precipitation-chart', {
                    'paper_bgcolor': '#191C24',
                    'plot_bgcolor': '#191C24',
                    'font.color': '#ffffff',
                    'xaxis.color': '#ffffff',
                    'yaxis.color': '#ffffff'
                });
            }
        })();
    </script>
{% endif %}

{% if not temperature_chart and not humidity_chart and not precipitation_chart %}
    <div class="d-flex justify-content-center align-items-center h-100">
        <div class="text-center">
            <i class="fa fa-chart-line fa-3x mb-3 text-muted"></i>
            <p>Select a chart type to display weather trends</p>
        </div>
    </div>
{% endif %}
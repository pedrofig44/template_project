<!-- wildfires/templates/wildfires/dashboard.html -->
{% extends 'includes/base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid pt-4 px-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-md-6">
            <h2 class="text-start">
                Wildfire Statistics Dashboard
                <span class="fs-6 text-muted ms-2">Annual Summary</span>
            </h2>
        </div>
        <div class="col-md-6 text-end">
            <!-- Simple dropdown for concelho selection -->
            <div class="dropdown d-inline-block">
                <button class="btn btn-primary dropdown-toggle" type="button" id="concelhoDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    {% if selected_concelho %}{{ selected_concelho.name }}{% else %}Select Concelho{% endif %}
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="concelhoDropdown" style="max-height: 300px; overflow-y: auto;">
                    {% for concelho in all_concelhos %}
                    <li><a class="dropdown-item {% if selected_concelho.dico_code == concelho.dico_code %}active{% endif %}" 
                          href="{% url 'wildfires:dashboard' %}?concelho={{ concelho.dico_code }}"
                          hx-get="{% url 'wildfires:dashboard' %}?concelho={{ concelho.dico_code }}"
                          hx-target="#dashboard-content"
                          hx-swap="innerHTML"
                          hx-trigger="click">
                        {{ concelho.name }}
                    </a></li>
                    {% empty %}
                    <li><a class="dropdown-item disabled" href="#">No concelhos available</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Dashboard Content Container for HTMX updates -->
    <div id="dashboard-content">
        {% include 'wildfires/dashboard_content.html' %}
    </div>
</div>

<!-- Script for updating charts on night mode toggle -->
<script>
// Apply night mode to charts when toggled
document.addEventListener('nightModeToggled', function() {
    if (document.body.classList.contains('night-mode')) {
        // Update charts for night mode if they exist
        if (typeof Plotly !== 'undefined') {
            document.querySelectorAll('[id^="chart-"]').forEach(function(chart) {
                Plotly.relayout(chart.id, {
                    'paper_bgcolor': '#1E1E1E',
                    'plot_bgcolor': '#1E1E1E',
                    'font.color': '#E0E0E0',
                    'xaxis.gridcolor': '#444444',
                    'yaxis.gridcolor': '#444444'
                });
            });
        }
    } else {
        // Revert to day mode
        if (typeof Plotly !== 'undefined') {
            document.querySelectorAll('[id^="chart-"]').forEach(function(chart) {
                Plotly.relayout(chart.id, {
                    'paper_bgcolor': '#F3F6F9',
                    'plot_bgcolor': '#F3F6F9',
                    'font.color': '#000000',
                    'xaxis.gridcolor': '#E0E0E0',
                    'yaxis.gridcolor': '#E0E0E0'
                });
            });
        }
    }
});
</script>
{% endblock %}